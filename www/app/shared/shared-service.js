"use strict";

angular.module("ngapp").service("shared", function($http, $localStorage, $mdToast){ 

    var ctrl = this;
    this.$storage = $localStorage;
    if(!this.$storage.settings) this.$storage.settings = {"starredEvents":{}, "ratedSessions":[]};

    this.lastDataUpdate = 0;
    //TODO
    this.apiSrv = 'https://ebs.api.nubenum.de/v1/';
    this.updateRequired = false;
    this.defaultData = {"meta":{"apiv":1,"appv":1,"ts":240},"days":[{"id":19,"title":"Wed 19th"},{"id":20,"title":"Thu 20th"},{"id":21,"title":"Fri 21st"}],"partnerFilters":[{"id":"corporate","name":"partners"},{"id":"sponsor","name":"sponsors"},{"id":"inno","name":"inno"}],"shuttleDisabled":true,"shuttleHotline":"","shuttleInfo":"It is not possible to order a shuttle right now. You can still view the pick-up locations.","scheduleTypeColors":{"speech":"004e8b","panel":"42aa85","duel-discussion":"004e8b","generic":"000000","open-workshop":"ffcc00","workshop":"ffcc00","interview":"ffcc00","presentation":"ffcc00","fair":"b20702"},"partners":[{"id":"accenturestrategyredwhite","type":"corporate","web":0},{"id":"amazon","type":"corporate","web":0},{"id":"ardianposirvb","type":"corporate","web":0},{"id":"armira","type":"corporate","web":0},{"id":"asiwirtschaftsberatung","type":"corporate","web":0},{"id":"bcglogocompactgreen","type":"corporate","web":0},{"id":"bearplogorgbps","type":"corporate","web":0},{"id":"bnppblq","type":"corporate","web":0},{"id":"capcmedium","type":"corporate","web":0},{"id":"cinven","type":"corporate","web":0},{"id":"deloittenewlogo","type":"corporate","web":0},{"id":"eco","type":"corporate","web":0},{"id":"efficiotheprocurementexpertspantonepng","type":"corporate","web":0},{"id":"emmalogocmykblue","type":"corporate","web":0},{"id":"ey-parthenonlogovpositivehorizontal","type":"corporate","web":0},{"id":"futury-logo-px","type":"corporate","web":0},{"id":"hlblktype","type":"corporate","web":0},{"id":"insiderstechnologieslogorgbrz","type":"corporate","web":0},{"id":"jpmdcmyk","type":"corporate","web":0},{"id":"kloeckner--co-sergb","type":"corporate","web":0},{"id":"kpmgbluelogo","type":"corporate","web":0},{"id":"linklaters","type":"corporate","web":0},{"id":"mattel-logo-","type":"corporate","web":0},{"id":"mckinseyandcompanylogo","type":"corporate","web":0},{"id":"mlplogommonlinergb","type":"corporate","web":0},{"id":"oliver-wyman-horizontalc","type":"corporate","web":0},{"id":"oscargmbhlogosvektorisiertweiss","type":"corporate","web":0},{"id":"pucschriftzugpos","type":"corporate","web":0},{"id":"rbccm","type":"corporate","web":0},{"id":"real-digital-with-claim-png-ohne-hintergrund","type":"corporate","web":0},{"id":"roland-blogoposrgbpx","type":"corporate","web":0},{"id":"rothschildlogo","type":"corporate","web":0},{"id":"rzp","type":"corporate","web":0},{"id":"strategyand-alternate-logobnew","type":"corporate","web":0},{"id":"werte-siftung-logo--farbig-blau","type":"corporate","web":0},{"id":"amapharm-logo","type":"sponsor","web":0},{"id":"ardo","type":"sponsor","web":0},{"id":"beamsuntorylogomission","type":"sponsor","web":0},{"id":"bss","type":"sponsor","web":0},{"id":"dinghartinger-logo","type":"sponsor","web":0},{"id":"dr","type":"sponsor","web":0},{"id":"evo","type":"sponsor","web":0},{"id":"fleursdeparis-logo-weiss","type":"sponsor","web":0},{"id":"fritz-kolaschwarz","type":"sponsor","web":0},{"id":"haribo","type":"sponsor","web":0},{"id":"hecho-amano","type":"sponsor","web":0},{"id":"jagermeister","type":"sponsor","web":0},{"id":"kalemelogoblack","type":"sponsor","web":0},{"id":"kitkatl","type":"sponsor","web":0},{"id":"mymusly","type":"sponsor","web":0},{"id":"outletcm-logo","type":"sponsor","web":0},{"id":"weingut-g","type":"sponsor","web":0},{"id":"weingut-robert-weil-logo","type":"sponsor","web":0},{"id":"yfoodnewfontmedium","type":"sponsor","web":0}],"pickupLocations":[{"id":"geisenheim.bhf","lat":49.98543,"lon":7.96826,"name":"Geisenheim Train Station"},{"id":"zangerstr","lat":50.029586,"lon":8.029839,"name":"Hallgarten Zangerstra\u00dfe 43"},{"id":"hallgarten-platz","lat":50.026714,"lon":8.031647,"name":"Hallgarten Hallgartener Platz 8"},{"id":"hattenheim-bhf","lat":50.013618,"lon":8.057386,"name":"Hattenheim Train Station"},{"id":"waldbachstr","lat":50.019062,"lon":8.051763,"name":"Hattenheim Junction Lehnstra\u00dfe\/Waldbachstra\u00dfe"},{"id":"rewe","lat":50.008887,"lon":8.038567,"name":"Oestrich-Winkel REWE Untere Bein"},{"id":"europaallee","lat":50.006268,"lon":8.032782,"name":"Oestrich-Winkel Europaallee"},{"id":"friedensplatz","lat":50.006217,"lon":8.028716,"name":"Oestrich-Winkel Friedensplatz"},{"id":"hauptstr-87","lat":49.995722,"lon":8.00131,"name":"Oestrich-Winkel Hauptstr. 87"},{"id":"hauptstr-52","lat":49.998748,"lon":8.008719,"name":"Oestrich-Winkel Hauptstr. 52"},{"id":"rheingaustr-129","lat":50.001633,"lon":8.014955,"name":"Oestrich-Winkel Rheingaustr. 129, Busstop Basilika"},{"id":"oestrich-bhf","lat":50.002362,"lon":8.019324,"name":"Oestrich-Winkel Train Station"}],"schedule":[{"id":"opening","type":"none","speakers":[],"day":19,"start":"11:00","duration":90,"room":"Forum","title":"Opening Ceremony","info":"","alert":""},{"id":"pieter-witteveen","type":"speech","speakers":["pieter-witteveen"],"day":19,"start":"14:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"cr-panel","type":"panel","speakers":[],"day":19,"start":"15:00","duration":90,"room":"Forum","title":"Customer Relationship in the Automotive Industry","info":"","alert":""},{"id":"dr-wolfgang-fink","type":"speech","speakers":["dr-wolfgang-fink"],"day":19,"start":"16:45","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"dr-tom-enders","type":"speech","speakers":["dr-tom-enders"],"day":19,"start":"17:45","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"bauer-laarmann","type":"discussion","speakers":["benjamin-bauer","max-laarman"],"day":19,"start":"19:30","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"closing","type":"none","speakers":["carsten-kratz"],"day":21,"start":"18:00","duration":60,"room":"Forum","title":"Closing Ceremony","info":"","alert":""},{"id":"deloitte-pr","type":"presentation","speakers":[],"day":19,"start":"14:00","duration":60,"room":"K4","title":"Deloitte","info":"","alert":""},{"id":"mm1-pr","type":"presentation","speakers":[],"day":19,"start":"15:30","duration":60,"room":"Audi","title":"mm1","info":"","alert":""},{"id":"ubs-pr","type":"presentation","speakers":[],"day":20,"start":"12:30","duration":60,"room":"Audi","title":"UBS","info":"","alert":""},{"id":"accenture-pr","type":"presentation","speakers":[],"day":20,"start":"14:30","duration":60,"room":"Max","title":"Accenture Strategy","info":"","alert":""},{"id":"futury-pr","type":"presentation","speakers":[],"day":21,"start":"10:00","duration":60,"room":"Audi","title":"Futury & Wertestiftung","info":"","alert":""},{"id":"career-fair","type":"generic","speakers":[],"day":20,"start":"10:00","duration":480,"room":"Pavilion","title":"Career Fair","info":"","alert":""},{"id":"innovation-fair","type":"generic","speakers":[],"day":21,"start":"10:00","duration":300,"room":"Pavilion","title":"Innovation Fair","info":"","alert":""},{"id":"cruise","type":"none","speakers":[],"day":20,"start":"18:45","duration":165,"room":"Gatehouse EBS Schloss","title":"Corporate Cruise","info":"By invitation only. Meeting Point: 18:50 at Gatehouse EBS Schloss. Boat is casting off at 7:30 pm. Cruise ends at 9:30 pm.","alert":""},{"id":"reception","type":"generic","speakers":[],"day":19,"start":"12:30","duration":30,"room":"Forum","title":"Drinks Reception","info":"","alert":""},{"id":"breakfast-20","type":"generic","speakers":[],"day":20,"start":"09:00","duration":90,"room":"Dining Hall","title":"Breakfast","info":"","alert":""},{"id":"breakfast-21","type":"generic","speakers":[],"day":21,"start":"09:00","duration":90,"room":"Dining Hall","title":"Breakfast","info":"","alert":""},{"id":"lunch-19","type":"generic","speakers":[],"day":19,"start":"13:00","duration":60,"room":"Dining Hall","title":"Lunch","info":"","alert":""},{"id":"lunch-20","type":"generic","speakers":[],"day":20,"start":"12:30","duration":120,"room":"Dining Hall","title":"Lunch","info":"","alert":""},{"id":"dinner-19","type":"generic","speakers":[],"day":19,"start":"18:00","duration":150,"room":"Dining Hall","title":"Dinner","info":"","alert":""},{"id":"dinner-20","type":"generic","speakers":[],"day":20,"start":"18:00","duration":120,"room":"Dining Hall","title":"Dinner","info":"","alert":""},{"id":"dinner-21","type":"generic","speakers":[],"day":21,"start":"18:00","duration":120,"room":"Dining Hall","title":"Dinner","info":"","alert":""},{"id":"party","type":"generic","speakers":[],"day":21,"start":"22:30","duration":0,"room":"Pavilion","title":"After Party","info":"","alert":""},{"id":"christian-lindner","type":"speech","speakers":["christian-lindner"],"day":19,"start":"20:30","duration":90,"room":"Forum","title":"A new Generation of Politics in Europe","info":"","alert":""},{"id":"phillip-markmann","type":"speech","speakers":["philipp-markmann"],"day":19,"start":"16:45","duration":45,"room":"KEB","title":"","info":"","alert":""},{"id":"lunch-21","type":"generic","speakers":[],"day":21,"start":"12:30","duration":120,"room":"Dining Hall","title":"Lunch","info":"","alert":""},{"id":"georg-mueller-stiftung","type":"none","speakers":[],"day":19,"start":"20:00","duration":120,"room":"K4, Audi, Max","title":"Georg M\u00fcller Stiftung","info":"By invitation only","alert":""},{"id":"dr-martin-reitz","type":"speech","speakers":["dr-martin-reitz"],"day":20,"start":"10:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"job-expectations-panel","type":"panel","speakers":[],"day":20,"start":"11:00","duration":90,"room":"Forum","title":"Changing Job Expectations","info":"","alert":""},{"id":"chris-kastenholz","type":"speech","speakers":["chris-kastenholz"],"day":20,"start":"14:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"dr-sang-jin-park","type":"speech","speakers":["dr-sang-jin-pak"],"day":20,"start":"15:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"inno-digit-panel","type":"panel","speakers":[],"day":20,"start":"16:00","duration":90,"room":"Forum","title":"Innovation\/Digitalisation","info":"","alert":""},{"id":"ralf-kleber","type":"speech","speakers":["ralf-kleber"],"day":20,"start":"18:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"evening-chat","type":"evening-chat","speakers":["lamine-cheloufi"],"day":20,"start":"19:45","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"dr-stephanie-caspar","type":"speech","speakers":["dr-stephanie-caspar"],"day":20,"start":"10:00","duration":45,"room":"KEB","title":"","info":"","alert":""},{"id":"enno-jackwerth","type":"speech","speakers":["enno-jackwerth"],"day":20,"start":"14:00","duration":45,"room":"KEB","title":"","info":"","alert":""},{"id":"nina-faulhaber","type":"speech","speakers":["nina-faulhaber"],"day":20,"start":"15:00","duration":45,"room":"KEB","title":"","info":"","alert":""},{"id":"parthenon-pr","type":"presentation","speakers":[],"day":20,"start":"13:30","duration":60,"room":"K4","title":"EY Parthenon","info":"","alert":""},{"id":"achleitner","type":"speech","speakers":["prof-dr-dr-ann-kristin-achleitner"],"day":21,"start":"10:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"hidden-champions-panel","type":"panel","speakers":[],"day":21,"start":"11:00","duration":90,"room":"Forum","title":"Hidden Champions","info":"","alert":""},{"id":"jonas-seyfferth","type":"speech","speakers":["jonas-seyfferth"],"day":21,"start":"14:00","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"gerhald-hoerhan","type":"speech","speakers":["gerald-hrhan"],"day":21,"start":"15:15","duration":45,"room":"Forum","title":"","info":"","alert":""},{"id":"finance-panel","type":"panel","speakers":[],"day":21,"start":"16:15","duration":90,"room":"Forum","title":"Finance","info":"","alert":""},{"id":"miriam-wohlfarth","type":"speech","speakers":["miriam-wohlfahrt"],"day":21,"start":"12:45","duration":45,"room":"KEB","title":"","info":"","alert":""},{"id":"kuchler-moller","type":"discussion","speakers":["florian-kuchler","ole-mller-jensen"],"day":21,"start":"14:00","duration":60,"room":"KEB","title":"","info":"","alert":""},{"id":"dietmar-keuschnig","type":"speech","speakers":["dietmar-keuschnig"],"day":21,"start":"15:15","duration":45,"room":"KEB","title":"","info":"","alert":""}],"invites":[{"id":"armira-ws","type":"workshop","speakers":[],"day":19,"start":"14:00","duration":210,"room":"K1","title":"Armira","info":"","alert":""},{"id":"accenture-ws","type":"workshop","speakers":[],"day":20,"start":"16:15","duration":120,"room":"K1","title":"Accenture Strategy","info":"","alert":""},{"id":"bcg-ws","type":"workshop","speakers":[],"day":20,"start":"10:00","duration":150,"room":"K1","title":"BCG","info":"","alert":""},{"id":"capgemini-ws","type":"workshop","speakers":[],"day":21,"start":"14:00","duration":120,"room":"Max","title":"Capgemini Consulting","info":"","alert":""},{"id":"mckinsey-ws","type":"workshop","speakers":[],"day":21,"start":"14:00","duration":120,"room":"K4","title":"McKinsey & Company","info":"","alert":""},{"id":"futury-ws","type":"workshop","speakers":[],"day":21,"start":"11:15","duration":120,"room":"Audi","title":"Futury & Wertestiftung","info":"","alert":""},{"id":"pupils-ws","type":"workshop","speakers":[],"day":21,"start":"10:45","duration":120,"room":"K1","title":"Sch\u00fcler @Symp","info":"","alert":""},{"id":"accenture-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"Accenture","info":"","alert":""},{"id":"bearingpoint-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"BearingPoint","info":"","alert":""},{"id":"bloomberg-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"Bloomberg","info":"","alert":""},{"id":"commerzreal-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"CommerzReal","info":"","alert":""},{"id":"e-co-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"e&Co","info":"","alert":""},{"id":"kpmg-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"KPMG","info":"","alert":""},{"id":"minodes-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"Minodes","info":"","alert":""},{"id":"mlp-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"MLP","info":"","alert":""},{"id":"mm1-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"mm1","info":"","alert":""},{"id":"roland-berger-iv-19","type":"interview","speakers":[],"day":19,"start":"00:00","duration":0,"room":"Forum","title":"Roland Berger","info":"","alert":""},{"id":"accenture-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"Accenture","info":"","alert":""},{"id":"bearingpoint-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"BearingPoint","info":"","alert":""},{"id":"bloomberg-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"Bloomberg","info":"","alert":""},{"id":"commerzreal-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"CommerzReal","info":"","alert":""},{"id":"deloitte-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Interview Reception","title":"Deloitte","info":"","alert":""},{"id":"e-co-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"e&Co","info":"","alert":""},{"id":"kpmg-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"KPMG","info":"","alert":""},{"id":"minodes-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"Minodes","info":"","alert":""},{"id":"mlp-iv-20","type":"interview","speakers":[],"day":20,"start":"00:00","duration":0,"room":"Forum","title":"MLP","info":"","alert":""},{"id":"accenture-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"Accenture","info":"","alert":""},{"id":"mm1-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"mm1","info":"","alert":""},{"id":"roland-berger-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"Roland Berger","info":"","alert":""},{"id":"bearingpoint-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"BearingPoint","info":"","alert":""},{"id":"bloomberg-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"Bloomberg","info":"","alert":""},{"id":"commerzreal-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"CommerzReal","info":"","alert":""},{"id":"deloitte-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Interview Reception","title":"Deloitte","info":"","alert":""},{"id":"e-co-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"e&Co","info":"","alert":""},{"id":"kpmg-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"KPMG","info":"","alert":""},{"id":"minodes-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"Minodes","info":"","alert":""},{"id":"mlp-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"MLP","info":"","alert":""},{"id":"mm1-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"mm1","info":"","alert":""},{"id":"roland-berger-iv-21","type":"interview","speakers":[],"day":21,"start":"00:00","duration":0,"room":"Forum","title":"Roland Berger","info":"","alert":""},{"id":"wyman-ws","type":"workshop","speakers":[],"day":20,"start":"14:00","duration":120,"room":"Audi","title":"Oliver Wyman","info":"","alert":""},{"id":"ardian-ws","type":"workshop","speakers":[],"day":20,"start":"16:15","duration":120,"room":"K4","title":"Ardian","info":"","alert":""},{"id":"cinven-ws","type":"workshop","speakers":[],"day":20,"start":"10:00","duration":120,"room":"K4","title":"Cinven","info":"","alert":""}],"speakers":[{"id":"prof-dr-dr-ann-kristin-achleitner","name":"Prof. Dr. Dr. Ann-Kristin Achleitner","info":"Member of the Supervisory Board","co":"Linde AG, ENGIE, MunichRE, Deutsche B\u00f6rse","text":"","patron":"Our Patron","web":1},{"id":"dr-arno-balzer","name":"Dr. Arno Balzer","info":"Publisher BILANZ Wirtschaftsmagazin","co":"BILANZ","text":"","patron":"","web":0},{"id":"benjamin-bauer","name":"Benjamin Bauer","info":"VP Consumer & Co-Founder","co":"Delivery Hero, foodpanda, Forbes 30 under 30","text":"","patron":"","web":0},{"id":"dr-stephanie-caspar","name":"Dr. Stephanie Caspar","info":"President Technology and Data","co":"Axel Springer SE","text":"","patron":"","web":0},{"id":"lamine-cheloufi","name":"Lamine Cheloufi","info":"Product Director","co":"Klarna, Forbes 30 under 30 2016","text":"","patron":"","web":0},{"id":"dr-tom-enders","name":"Dr. Tom Enders","info":"Chief Executive Officer","co":"Airbus SE","text":"","patron":"","web":0},{"id":"nina-faulhaber","name":"Nina Faulhaber","info":"Co-Founder & Co-CEO","co":"ADAY, Forbes 30 under 30 2016","text":"","patron":"","web":0},{"id":"dr-wolfgang-fink","name":"Dr. Wolfgang Fink","info":"Chief Executive Officer","co":"Goldman Sachs Austria&Germany","text":"","patron":"","web":0},{"id":"leonhard-fischer","name":"Leonhard Fischer","info":"CEO & Director","co":"BHF Kleinwort Benson Group","text":"","patron":"","web":0},{"id":"christian-hirsch","name":"Christian Hirsch","info":"Partner","co":"Civitas International Management Consultants","text":"","patron":"","web":0},{"id":"gerald-hrhan","name":"Gerald H\u00f6rhan","info":"Managing Director","co":"Investmentpunk\/Danube Advisory GmbH","text":"","patron":"","web":0},{"id":"enno-jackwerth","name":"Enno Jackwerth","info":"Head of HR Germany","co":"Fujitsu","text":"","patron":"","web":0},{"id":"dr-christian-kames","name":"Dr. Christian Kames","info":"Head of Investment Banking Germany","co":"JP Morgan","text":"","patron":"","web":0},{"id":"rasa-karapandza","name":"Rasa Karapandza","info":"Chaired Professor of Finance","co":"EBS Universit\u00e4t f\u00fcr Wirtschaft und Recht","text":"","patron":"","web":0},{"id":"chris-kastenholz","name":"Chris Kastenholz","info":"Co-Founder & CEO","co":"Pulse Group, Forbes 30 under 30","text":"","patron":"","web":0},{"id":"dietmar-keuschnig","name":"Dietmar Keuschnig","info":"CEO","co":"Nespresso GmbH, Mammut Sports Group, & iSi Culinary GmbH","text":"","patron":"","web":0},{"id":"ralf-kleber","name":"Ralf Kleber","info":"Country Manager","co":"Amazon Germany","text":"","patron":"","web":0},{"id":"jens-klitzke","name":"Jens Klitzke","info":"Head of Customer Management and Digitalization in Sales Germany","co":"Volkswagen","text":"","patron":"","web":0},{"id":"carsten-kratz","name":"Carsten Kratz","info":"Head of the Management Team Germany&Austria","co":"The Boston Consulting Group","text":"","patron":"","web":0},{"id":"florian-kuchler","name":"Florian Kuchler","info":"Regional Head of HR Central Europe","co":"Danfoss","text":"","patron":"","web":0},{"id":"max-laarman","name":"Max Laarman","info":"Founder","co":"Emma Matratzen, Forbes 30 under 30 2018","text":"","patron":"","web":0},{"id":"christian-lindner","name":"Christian Lindner","info":"Member of the Bundestag & Leader of the Party","co":"Free Democratic Party (FDP)","text":"","patron":"","web":0},{"id":"philipp-markmann","name":"Philipp Markmann","info":"Chief Marketing Officer","co":"L'Or\u00e9al Deutschland","text":"","patron":"","web":0},{"id":"ralf-mayer-de-groot","name":"Ralf Mayer de Groot","info":"CEO","co":"Mayer de Groot Marketing-Research and Consult","text":"","patron":"","web":0},{"id":"ole-mller-jensen","name":"Ole M\u00f6ller-Jensen","info":"Regional President Central Europe","co":"Danfoss","text":"","patron":"","web":0},{"id":"daniela-mndler","name":"Daniela M\u00fcndler","info":"Member of the Management Board","co":"Bahlsen GmbH & Co. KG","text":"","patron":"","web":0},{"id":"dr-sang-jin-pak","name":"Dr. Sang-Jin Pak","info":"Chief Operations Officer","co":"Samsung Bioepis","text":"","patron":"","web":0},{"id":"martin-reim","name":"Martin Reim","info":"Chief Financial Officer","co":"Schwan-Stabilo","text":"","patron":"","web":0},{"id":"dr-martin-reitz","name":"Dr. Martin Reitz","info":"Co-Chairman of the Global Management Commitee & Country Head Germany","co":"Rothschild","text":"","patron":"","web":0},{"id":"sarna-rser","name":"Sarna R\u00f6ser","info":"Bundesvorsitzende","co":"DIE JUNGEN UNTERNEHMER","text":"","patron":"","web":0},{"id":"dr-bernhard-rosenberger","name":"Dr. Bernhard Rosenberger","info":"Partner","co":"Rosenberger & Partner","text":"","patron":"","web":0},{"id":"dr-thomas-schlick","name":"Dr. Thomas Schlick","info":"Senior Partner","co":"Roland Berger","text":"","patron":"","web":0},{"id":"stefan-schulte","name":"Stefan Schulte","info":"Chief Executive Officer","co":"Fraport","text":"","patron":"","web":0},{"id":"thomas-schweppe","name":"Thomas Schweppe","info":"CEO & Founder","co":"7Square Partners (former Senior Investmentbanker Goldman Sachs)","text":"","patron":"","web":0},{"id":"jonas-seyfferth","name":"Jonas Seyfferth","info":"Principal","co":"Strategy&","text":"","patron":"","web":0},{"id":"mark-sommer","name":"Mark Sommer","info":"Director Business Development & Operator Partnerships EMEA","co":"Facebook","text":"","patron":"","web":0},{"id":"christa-stienen","name":"Christa Stienen","info":"Vice President","co":"Bundesverband der Personalmanager (BPM)","text":"","patron":"","web":0},{"id":"claus-wattendrup","name":"Claus Wattendrup","info":"Vice President Solar & Batteries","co":"Vattenfall","text":"","patron":"","web":0},{"id":"engelbert-wimmer","name":"Engelbert Wimmer","info":"Chief Executive Officer","co":"e&co.","text":"","patron":"","web":0},{"id":"miriam-wohlfahrt","name":"Miriam Wohlfahrt","info":"CEO & Founder","co":"RatePAY","text":"","patron":"","web":0},{"id":"carsten-wreth","name":"Carsten Wreth","info":"Chief Customer Officer & VP Customer Experience","co":"Opel & Vauxhall","text":"","patron":"","web":0},{"id":"pieter-witteveen","name":"Pieter Witteveen","info":"Senior Managing Director","co":"EY Parthenon","text":"","patron":"","web":0}]};

    this.getObjectById = function(needle, haystack) {
        for (var i=0;i<haystack.length;i++) {
            if (haystack[i].id == needle) return haystack[i];
        }
        return null;
    }

    this.isCurrentData = function(incomingData) {
        if (incomingData && incomingData.meta) {
            if(ctrl.defaultData.meta.appv < incomingData.meta.appv) this.updateRequired = true;
            else this.updateRequired = false;
            if (ctrl.defaultData.meta.apiv == incomingData.meta.apiv && ctrl.$storage.data.meta.ts <= incomingData.meta.ts) {
                return true;
            }
        } 
        return false;
    }
   
    if (!this.$storage.data || this.isCurrentData(this.defaultData)) {
        this.$storage.data = this.defaultData;
    } 

    this.getUniqueToken = function () {
        if (!ctrl.$storage.settings.fcmt) { 
            var d = new Date();
            ctrl.$storage.settings.fcmt = "substitute-"+d.getTime();
        }
        console.log('unique'+ctrl.$storage.settings.fcmt);
        return ctrl.$storage.settings.fcmt;
    }

    this.getStarredScheduleString = function() {
        var obj = ctrl.$storage.settings.starredEvents;
        var concat = '';
        angular.forEach(obj, function(value, key) {
            if (value) concat += ','+key;
            if (value && value !== true) concat += '_'+value;
        });
        if (concat.length > 0) concat = concat.substring(1);
        return concat;
    }

    this.updateData = function(force) {
        var d = new Date();
        var diff = d.getTime()-ctrl.lastDataUpdate;
        if (!force && diff < 1000000 || force && diff < 3000) return;
        var apiUrl = ctrl.apiSrv+'data.php';
        apiUrl = ctrl.apiSrv+'data.php?appv='+ctrl.defaultData.meta.appv+'&fcmt='+ctrl.getUniqueToken()+'&datats='+ctrl.$storage.data.meta.ts+'&reminders='+!!ctrl.$storage.settings.reminders+'&starred='+ctrl.getStarredScheduleString();
        
        $http({method: 'GET',url:apiUrl})
        .then(function successCallback(response) {
            console.log('data received '+apiUrl);
            ctrl.lastDataUpdate = d.getTime();            
            if (ctrl.isCurrentData(response.data)) {
                ctrl.$storage.data = response.data;
                console.log('data updated');
            }
        }, function errorCallback(response) {
            console.log('no conn');
        });     
        
    }

    

    
    
    
});
